<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guestbook</title>

<style>
  body {
    margin: 0;
    padding: 20px;
    background-color: #ECE4CE;
    height: 100vh;
    box-sizing: border-box;
    font-family: monospace;
    color: #2c1d15;
  }

  #messages {
    margin-bottom: 16px;
    line-height: 1.7;
  }

  .message {
    margin-bottom: 8px;
    user-select: none;
  }

  #input-area {
    display: flex;
    gap: 8px;
  }

  input {
    flex: 1;
    padding: 10px;
    font-size: 16px;
    background: transparent;
    border: 1px solid rgba(44,29,21,0.3);
    color: #2c1d15;
  }

  input::placeholder {
    color: #2c1d15;
    opacity: 0.3;
  }

  button {
    padding: 10px 16px;
    font-size: 16px;
    background: transparent;
    border: 1px solid #2c1d15;
    color: #2c1d15;
    cursor: pointer;
  }
</style>
</head>

<body>

<div id="messages"></div>

<div id="input-area">
  <input
    id="input"
    placeholder="ì˜ì‹¬ë˜ëŠ” ì°¸, ë¯¿ê³  ì‹¶ì€ ê±°ì§“ì„ ì•Œë ¤ì£¼ì„¸ìš”."
  >
  <button id="send">ì „ì†¡</button>
</div>

<!-- ðŸ”¥ Firebase (MODULE ë°©ì‹ Â· v12) -->
<script type="module">
  /* Firebase SDK import */
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
  import {
    getDatabase,
    ref,
    push,
    onValue,
    remove
  } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

  /* âœ… ë„¤ê°€ Firebase ì½˜ì†”ì—ì„œ ë°›ì€ ì„¤ì • (ê·¸ëŒ€ë¡œ ì‚¬ìš©) */
  const firebaseConfig = {
    apiKey: "AIzaSyBsefm8MgoTF9TVzkvr81-Z75GHJ9rzqto",
    authDomain: "agreeye-ea0e4.firebaseapp.com",
    databaseURL: "https://agreeye-ea0e4-default-rtdb.firebaseio.com",
    projectId: "agreeye-ea0e4",
    storageBucket: "agreeye-ea0e4.firebasestorage.app",
    messagingSenderId: "849373660989",
    appId: "1:849373660989:web:dbe61aa193476a48e56754",
    measurementId: "G-HVB8TQK8F7"
  };

  /* Firebase ì´ˆê¸°í™” */
  const app = initializeApp(firebaseConfig);
  getAnalytics(app);

  const db = getDatabase(app);
  const messagesRef = ref(db, "messages");

  const input = document.getElementById("input");
  const messages = document.getElementById("messages");
  const sendBtn = document.getElementById("send");

  /* ðŸ” ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë“  ê¸°ê¸°ì—ì„œ ë™ì¼í•˜ê²Œ ë™ê¸°í™” */
  onValue(messagesRef, snapshot => {
    messages.innerHTML = "";
    snapshot.forEach(child => {
      const div = document.createElement("div");
      div.className = "message";
      div.textContent = child.val().text;

      /* ðŸ“± ê¸¸ê²Œ ëˆŒëŸ¬ ì‚­ì œ */
      let timer;
      div.addEventListener("touchstart", () => {
        timer = setTimeout(() => {
          if (confirm("ì´ ë¬¸ìž¥ì„ ì‚­ì œí• ê¹Œìš”?")) {
            remove(ref(db, "messages/" + child.key));
          }
        }, 800);
      });
      div.addEventListener("touchend", () => {
        clearTimeout(timer);
      });

      messages.appendChild(div);
    });
  });

  function sendMessage() {
    const text = input.value.trim();
    if (!text) return;

    push(messagesRef, {
      text: text,
      timestamp: Date.now()
    });

    input.value = "";
  }

  sendBtn.addEventListener("click", sendMessage);
  input.addEventListener("keydown", e => {
    if (e.key === "Enter") sendMessage();
  });
</script>

</body>
</html>
